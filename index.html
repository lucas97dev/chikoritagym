<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a4d2e">
    <meta name="description" content="ChikoritaGym - Treine, evolua e fique mais forte a cada dia!">
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23a3d977'/><text x='50' y='70' font-size='60' text-anchor='middle'>üçÉ</text></svg>">
    <title>ChikoritaGym</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a4d2e 0%, #4f772d 50%, #1a4d2e 100%);
            min-height: 100vh;
            padding: 20px;
            scroll-behavior: smooth;
        }

        .container { max-width: 800px; margin: 0 auto; }

        /* Melhorias no Design dos Cards */
        .card {
            background: rgba(199, 244, 100, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(163, 217, 119, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            transition: transform 0.2s ease;
        }

        .exercise-card {
            background: rgba(255,255,255,0.95);
            border: 2px solid #a3d977;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .exercise-card:focus-within {
            border-color: #ffd93d;
            box-shadow: 0 0 15px rgba(255, 217, 61, 0.4);
        }

        /* Bot√µes Estilizados */
        .btn {
            min-height: 48px; /* Melhor para toque mobile */
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .btn:active { transform: scale(0.95); }

        .btn-primary { background: #a3d977; color: #1a4d2e; }
        .btn-secondary { background: #ffd93d; color: #1a4d2e; }
        .btn-success { background: #a3d977; color: #1a4d2e; }
        .btn-danger { background: #ef5350; color: white; }

        /* Header e T√≠tulos */
        .header { text-align: center; margin-bottom: 30px; color: white; }
        .header h1 { font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .section-title { color: white; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }

        /* Timer e Progresso */
        .timer-display {
            background: linear-gradient(135deg, #ffd93d 0%, #ffeb3b 100%);
            border: 3px solid #f9a825;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }

        .timer-time { font-size: 3em; font-weight: bold; color: #1a4d2e; }

        .history-item {
            background: #f1f8e9;
            border-left: 4px solid #c7f464;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
        }

        /* Utilit√°rios */
        .hidden { display: none !important; }
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        
        @media (max-width: 600px) {
            .btn-group { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                <span style="font-size: 2.5em;">üçÉ</span>
                <h1>ChikoritaGym</h1>
            </div>
            <p style="color: #c7f464;">Treine, evolua e fique mais forte!</p>
        </header>

        <div id="listView">
            <div class="btn-group">
                <button class="btn btn-primary" onclick="showAddWorkout()">‚ûï Nova Ficha</button>
                <button class="btn btn-secondary" onclick="showProgress()">üìà Progresso</button>
            </div>
            <div id="workoutList"></div>
        </div>

        <div id="editView" class="hidden">
            <div class="card">
                <h2 class="section-title">üìù Editar Ficha</h2>
                <input type="text" id="workoutDay" placeholder="Ex: Segunda-feira" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:2px solid #a3d977;">
                <input type="text" id="workoutName" placeholder="Ex: Peito e Tr√≠ceps" style="width:100%; padding:12px; margin-bottom:20px; border-radius:8px; border:2px solid #a3d977;">
                
                <div id="exercisesList"></div>
                
                <button class="btn btn-primary" style="width:100%; margin-bottom:10px;" onclick="addExerciseToEdit()">‚ûï Adicionar Exerc√≠cio</button>
                <div class="btn-group">
                    <button class="btn btn-success" style="flex:1" onclick="saveWorkout()">Salvar</button>
                    <button class="btn btn-danger" style="flex:1" onclick="cancelEdit()">Cancelar</button>
                </div>
            </div>
        </div>

        <div id="viewWorkout" class="hidden">
            <button class="btn" style="background:none; color:#c7f464; margin-bottom:10px;" onclick="backToList()">‚Üê Voltar</button>
            <div id="workoutDetail"></div>
        </div>

        <div id="progressView" class="hidden">
            <button class="btn" style="background:none; color:#c7f464; margin-bottom:10px;" onclick="closeProgress()">‚Üê Voltar</button>
            <div id="progressList"></div>
        </div>
    </div>

    <script>
        let workouts = JSON.parse(localStorage.getItem('chikoritaGymWorkouts')) || [];
        let editingWorkout = null;
        let timerInterval = null;

        // --- SISTEMA DE √ÅUDIO ---
        function playBeep() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.setValueAtTime(880, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                osc.start();
                osc.stop(ctx.currentTime + 0.5);
            } catch(e) { console.log("√Åudio bloqueado"); }
        }

        // --- CORE LOGIC ---
        function saveToStorage() {
            localStorage.setItem('chikoritaGymWorkouts', JSON.stringify(workouts));
        }

        function renderWorkoutList() {
            const listDiv = document.getElementById('workoutList');
            if (workouts.length === 0) {
                listDiv.innerHTML = `<div class="card" style="text-align:center; color:white;"><h3>Nenhuma ficha criada.</h3><p>Toque em Nova Ficha para come√ßar!</p></div>`;
                return;
            }
            listDiv.innerHTML = workouts.map((w, i) => `
                <div class="card" onclick="viewWorkout(${i})" style="cursor:pointer">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <h3 style="color:white">üìÖ ${w.day}</h3>
                            <p style="color:#c7f464">${w.name}</p>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button class="btn btn-primary" style="padding:8px" onclick="event.stopPropagation(); editWorkout(${i})">‚úèÔ∏è</button>
                            <button class="btn btn-danger" style="padding:8px" onclick="event.stopPropagation(); deleteWorkout(${i})">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function viewWorkout(index) {
            const w = workouts[index];
            const detail = document.getElementById('workoutDetail');
            detail.innerHTML = `
                <div class="card">
                    <h2 style="color:white; margin-bottom:20px;">${w.day} - ${w.name}</h2>
                    ${w.exercises.map((ex, exI) => `
                        <div class="exercise-card">
                            <h3 style="color:#1a4d2e">${ex.name}</h3>
                            ${ex.notes ? `<p style="font-size:0.8em; color:#4f772d; margin-bottom:10px;">üìù ${ex.notes}</p>` : ''}
                            
                            ${ex.series.map((s, sI) => `
                                <div style="background:#f1f8e9; padding:10px; border-radius:8px; margin-top:10px;">
                                    <div style="display:flex; justify-content:space-between; font-weight:bold; color:#1a4d2e">
                                        <span>S√©rie ${sI + 1} (${s.minReps}-${s.maxReps} reps)</span>
                                        <span>‚è±Ô∏è ${s.rest}s</span>
                                    </div>
                                    
                                    <div id="timer-${exI}-${sI}" class="hidden timer-display">
                                        <div class="timer-time" id="time-${exI}-${sI}">00:00</div>
                                        <button class="btn btn-danger" style="width:100%" onclick="stopTimer(${exI}, ${sI})">Pular Descanso</button>
                                    </div>

                                    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:5px; margin-top:10px;">
                                        <input type="number" id="w-${exI}-${sI}" placeholder="kg" style="padding:8px; border-radius:5px; border:1px solid #ccc;">
                                        <input type="number" id="r-${exI}-${sI}" placeholder="reps" style="padding:8px; border-radius:5px; border:1px solid #ccc;">
                                        <button class="btn btn-success" style="min-height:auto" onclick="registerSet(${index}, ${exI}, ${sI})">OK</button>
                                    </div>
                                    
                                    <div style="margin-top:10px;" id="hist-${exI}-${sI}">
                                        ${(s.history || []).slice(-1).map(h => `
                                            <div class="history-item">
                                                <span>√öltimo: <b>${h.weight}kg</b> x ${h.reps}</span>
                                                <span>${new Date(h.date).toLocaleDateString()}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('listView').classList.add('hidden');
            document.getElementById('viewWorkout').classList.remove('hidden');
        }

        function registerSet(wIdx, exIdx, sIdx) {
            const weight = parseFloat(document.getElementById(`w-${exIdx}-${sIdx}`).value);
            const reps = parseInt(document.getElementById(`r-${exIdx}-${sIdx}`).value);
            
            if(!weight || !reps) return alert("Preencha os dados!");

            const serie = workouts[wIdx].exercises[exIdx].series[sIdx];
            if(!serie.history) serie.history = [];
            
            // Recorde Pessoal
            const last = serie.history[serie.history.length-1];
            if(last && weight > last.weight) {
                if(navigator.vibrate) navigator.vibrate([100, 50, 100]);
                alert("‚≠ê NOVO RECORDE!");
            }

            serie.history.push({ weight, reps, date: new Date().toISOString() });
            saveToStorage();
            if(navigator.vibrate) navigator.vibrate(50);
            
            startTimer(exIdx, sIdx, serie.rest);
        }

        function startTimer(exI, sI, seconds) {
            const display = document.getElementById(`timer-${exI}-${sI}`);
            const timeSpan = document.getElementById(`time-${exI}-${sI}`);
            display.classList.remove('hidden');
            
            let remaining = seconds;
            if(timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                remaining--;
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                timeSpan.innerText = `${mins}:${secs.toString().padStart(2, '0')}`;
                
                if(remaining <= 0) {
                    clearInterval(timerInterval);
                    playBeep();
                    if(navigator.vibrate) navigator.vibrate([300, 100, 300]);
                    timeSpan.innerText = "PRONTO!";
                    setTimeout(() => display.classList.add('hidden'), 2000);
                }
            }, 1000);
        }

        function stopTimer(exI, sI) {
            clearInterval(timerInterval);
            document.getElementById(`timer-${exI}-${sI}`).classList.add('hidden');
        }

        // --- FUN√á√ïES DE EDI√á√ÉO (Simplificadas) ---
        function showAddWorkout() {
            editingWorkout = { day: '', name: '', exercises: [] };
            document.getElementById('workoutDay').value = '';
            document.getElementById('workoutName').value = '';
            document.getElementById('exercisesList').innerHTML = '';
            document.getElementById('listView').classList.add('hidden');
            document.getElementById('editView').classList.remove('hidden');
        }

        function addExerciseToEdit() {
            const div = document.createElement('div');
            div.className = 'exercise-card';
            const id = Date.now();
            div.innerHTML = `
                <input type="text" placeholder="Nome do exerc√≠cio" class="ex-name" style="width:100%; margin-bottom:10px; padding:8px;">
                <input type="number" placeholder="Descanso (seg)" class="ex-rest" value="60" style="width:100%; margin-bottom:10px; padding:8px;">
                <div style="display:flex; gap:5px;">
                    <input type="number" placeholder="Min Reps" class="ex-min" value="8" style="flex:1; padding:8px;">
                    <input type="number" placeholder="Max Reps" class="ex-max" value="12" style="flex:1; padding:8px;">
                </div>
                <button class="btn btn-danger" style="width:100%; margin-top:10px; min-height:30px;" onclick="this.parentElement.remove()">Remover</button>
            `;
            document.getElementById('exercisesList').appendChild(div);
        }

        function saveWorkout() {
            const day = document.getElementById('workoutDay').value;
            const name = document.getElementById('workoutName').value;
            const exCards = document.querySelectorAll('#exercisesList .exercise-card');
            
            const exercises = Array.from(exCards).map(card => ({
                name: card.querySelector('.ex-name').value,
                series: [{
                    minReps: card.querySelector('.ex-min').value,
                    maxReps: card.querySelector('.ex-max').value,
                    rest: card.querySelector('.ex-rest').value,
                    history: []
                }]
            }));

            if(editingWorkout.index !== undefined) {
                workouts[editingWorkout.index] = { day, name, exercises };
            } else {
                workouts.push({ day, name, exercises });
            }
            
            saveToStorage();
            cancelEdit();
            renderWorkoutList();
        }

        function editWorkout(i) {
            showAddWorkout();
            editingWorkout.index = i;
            const w = workouts[i];
            document.getElementById('workoutDay').value = w.day;
            document.getElementById('workoutName').value = w.name;
            w.exercises.forEach(ex => {
                addExerciseToEdit();
                const last = document.querySelector('#exercisesList .exercise-card:last-child');
                last.querySelector('.ex-name').value = ex.name;
                last.querySelector('.ex-rest').value = ex.series[0].rest;
                last.querySelector('.ex-min').value = ex.series[0].minReps;
                last.querySelector('.ex-max').value = ex.series[0].maxReps;
            });
        }

        function deleteWorkout(i) {
            if(confirm("Excluir esta ficha?")) {
                workouts.splice(i, 1);
                saveToStorage();
                renderWorkoutList();
            }
        }

        function showProgress() {
            const list = document.getElementById('progressList');
            list.innerHTML = `<h2 class="section-title">Evolu√ß√£o</h2>`;
            workouts.forEach(w => {
                w.exercises.forEach(ex => {
                    ex.series.forEach(s => {
                        if(s.history && s.history.length > 1) {
                            const first = s.history[0].weight;
                            const last = s.history[s.history.length-1].weight;
                            const diff = last - first;
                            list.innerHTML += `
                                <div class="card">
                                    <h4 style="color:white">${ex.name}</h4>
                                    <p style="color:#c7f464">Evolu√ß√£o: +${diff}kg (In√≠cio: ${first}kg ‚Üí Atual: ${last}kg)</p>
                                </div>
                            `;
                        }
                    });
                });
            });
            document.getElementById('listView').classList.add('hidden');
            document.getElementById('progressView').classList.remove('hidden');
        }

        function backToList() {
            document.getElementById('viewWorkout').classList.add('hidden');
            document.getElementById('listView').classList.remove('hidden');
            renderWorkoutList();
        }

        function cancelEdit() {
            document.getElementById('editView').classList.add('hidden');
            document.getElementById('listView').classList.remove('hidden');
        }

        function closeProgress() {
            document.getElementById('progressView').classList.add('hidden');
            document.getElementById('listView').classList.remove('hidden');
        }

        // Inicializa√ß√£o
        renderWorkoutList();
    </script>
</body>
</html>
